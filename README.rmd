---
output: github_document
---

# sindicatoscl <img src="man/figures/logores.PNG" align="right" width = "120px"/>

Paquete R para acceder a registro administrativo de sindicatos activos y en receso en Chile (1920-2021)


# Instalar y cargar paquete

```{r eval=FALSE}
install.packages("devtools")
devtools::install_github("nicolasrattor/sindicatoscl")
```

```{r}
library(sindicatoscl)
library(dplyr)
```


# Uso del paquete

## Obtener el registro en bruto

```{r eval=FALSE}
sindicatos
```

```{r echo=FALSE}
dim(sindicatos)
knitr::kable(head(sindicatos[,1:4]))
names(sindicatos[,5:ncol(sindicatos)])
```

## Agrupar por empresa

```{r eval=FALSE}
empresas_sindicatos_activos()
```

```{r echo=FALSE}
head(empresas_sindicatos_activos())
```

## Indicador de fragmentación sindical

```{r}
empresas <- empresas_sindicatos_activos()
summary(empresas$sindicatos)

sectores <- sii_agregar() %>% group_by(rut_empresa) %>% summarise(rubro_sii=first(rubro_sii))
empresas <- merge(empresas,sectores,by="rut_empresa",all.x = TRUE)
empresas %>% group_by(rubro_sii) %>% summarise(fragmentacion=mean(sindicatos),
                                               n=n()) %>% 
  arrange(-fragmentacion)
```


## Serie histórica sindicatos constituidos

```{r}
serie <- constitucion_anual()
plot(serie$ano,serie$sindicatos,type = "l")
```


## Serie histórica activos

```{r}
serie <- activos_historico(desde=2020,hasta=2021)
serie$fecha <- lubridate::make_date(year=serie$ano,month=serie$mes)
plot(serie$fecha,serie$sindicatos,type = "l")
```



## Consultar sindicatos activos por fecha

```{r}
nrow(activos_en(ano=1990,mes=1))
head(activos_en(ano=1990,mes=1)[,c(1:4)])
```



## Consultar por nombre sindicato o empresa

```{r}
buscar_sindicatos(empresa_buscada="walmart",sindicato_buscado="lider")[,c(2,3)]
buscar_sindicatos(empresa_buscada="codelco",sindicato_buscado="")[,c(2,3)]
buscar_sindicatos(empresa_buscada="",sindicato_buscado="casa particular")[,c(2,3)]
```



## Obtener solo a los sindicatos activos (en 2021)

```{r eval=FALSE}
sindicatos_activos()
```

```{r echo=FALSE}
dim(sindicatos_activos())
knitr::kable(head(sindicatos_activos()[,1:4]))
```


## Obtener solo a los sindicatos de empresa

```{r eval=FALSE}
sindicatos_empresas()
```

```{r echo=FALSE}
dim(sindicatos_empresas())
knitr::kable(head(sindicatos_empresas()[,1:4]))
```

## Obtener datos del Servicio de Impuestos Internos

```{r}
datos <- sii_agregar()
knitr::kable(
  dplyr::mutate(
  as.data.frame(
    round(
      prop.table(
        table(datos$rubro_sii,useNA="ifany")),3)
    ),Freq=Freq*100
  )
)
```

**Tasa de sindicalización**

Proporción de sindicatos con tasa de sindicalización válida

```{r}
nrow(datos[datos$tasa_sindicalizacion<=1&!is.na(datos$tasa_sindicalizacion),])/nrow(datos)
```

Resumen variable tasa de sindicalización

```{r}
summary(datos[datos$tasa_sindicalizacion<=1,]$tasa_sindicalizacion)
```


# Sobre los datos usados

Registros administrativos de acceso público de la Dirección del Trabajo. Disponibles para descarga en: <https://tramites.dirtrab.cl/VentanillaTransparencia/Transparencia/RerporteRRLLOrg.aspx>. Los datos utilizados en el paquete fueron descargados el `r lubridate::today()` y son actualizados el último día de cada mes. 

# Uso de los datos

Los Registros administrativos de la Dirección del Trabajo los hemos utilizado en el [Repositorio de Estadísticas Sindicales](https://repositoriosindical.netlify.app/), para la elaboración de la [**Minuta N°1** Sindicatos en la coyuntura del estallido social y la pandemia (2018-2021)](https://github.com/nicolasrattor/Ventanilla_Sindicatos_DT/raw/main/Minuta1/Minuta1.pdf).
